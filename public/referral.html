<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Referral Program</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="/style.css" />
</head>
<body>

  <div class="page">

    <h2>ğŸ¤ Referral Program</h2>

    <p class="desc">
      Invite friends and earn rewards when they join the game.
    </p>

    <!-- ===== REFERRAL LINK ===== -->
    <div class="card">
      <label>Your Referral Link</label>

      <input
        type="text"
        id="refLink"
        readonly
        value="Loading..."
      />

      <button onclick="copyRef()">ğŸ“‹ Copy Link</button>
    </div>

    <!-- ===== STATS ===== -->
    <div class="card">
      <p>ğŸ‘¥ Total Referrals</p>
      <h3 id="refCount">0</h3>
    </div>

    <!-- ===== INFO ===== -->
    <div class="info">
      <p>ğŸ Reward per referral</p>
      <ul>
        <li>+500 Balance</li>
        <li>More rewards coming soon ğŸš€</li>
      </ul>
    </div>

    <button class="back" onclick="goBack()">â¬… Back to Game</button>

  </div>

  <!-- ===== REFERRAL SCRIPT (STANDALONE) ===== -->
  <script>
    let USER = null;

    async function initReferral() {
      try {
        const res = await fetch("/api/user", {
          method: "POST",
          credentials: "include"
        });

        const data = await res.json();
        if (!data.success) throw "NO_USER";

        USER = data;

        const link =
          window.location.origin + "/?ref=" + USER.userId;

        document.getElementById("refLink").value = link;

        document.getElementById("refCount").innerText =
          USER.referralsCount || 0;

      } catch (err) {
        alert("âŒ User not initialized");
        console.error("REF INIT ERROR:", err);
      }
    }

    function copyRef() {
      const input = document.getElementById("refLink");
      input.select();
      input.setSelectionRange(0, 99999);
      document.execCommand("copy");
      alert("âœ… Referral link copied");
    }

    function goBack() {
      window.location.href = "/";
    }

    initReferral();
  </script>

</body>
</html>
