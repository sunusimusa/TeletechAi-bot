<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Referral</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="/style.css" />
</head>
<body>

  <div class="page">

    <h2>ğŸ¤ Referral Program</h2>

    <p class="desc">
      Invite friends and earn rewards when they join the game.
    </p>

    <!-- REF LINK -->
    <div class="card">
      <label>Your Referral Link</label>
      <input
        type="text"
        id="refLink"
        readonly
        value="Loading..."
      />
      <button onclick="copyRef()">ğŸ“‹ Copy Link</button>
    </div>

    <!-- STATS -->
    <div class="card">
      <p>ğŸ‘¥ Total Referrals:</p>
      <h3 id="refCount">0</h3>
    </div>

    <!-- INFO -->
    <div class="info">
      <p>ğŸ Reward per referral:</p>
      <ul>
        <li>+500 Balance</li>
        <li>More rewards coming soon ğŸš€</li>
      </ul>
    </div>

    <button class="back" onclick="goBack()">â¬… Back to Game</button>

  </div>

  <!-- MAIN LOGIC -->
  <script src="/index.js"></script>

  <!-- REFERRAL PAGE SCRIPT -->
  <script>
    async function loadReferral() {
      try {
        const res = await fetch("/api/user", {
          method: "POST",
          credentials: "include"
        });

        const data = await res.json();
        if (!data.success) return;

        const refLink = `${location.origin}/?ref=${data.userId}`;
        document.getElementById("refLink").value = refLink;

        // referralsCount idan kana turawa daga server
        if (data.referralsCount !== undefined) {
          document.getElementById("refCount").innerText =
            data.referralsCount;
        }

      } catch (e) {
        console.error("REFERRAL LOAD ERROR", e);
      }
    }

    function copyRef() {
      const i = document.getElementById("refLink");
      i.select();
      document.execCommand("copy");
      alert("âœ… Referral link copied");
    }

    function goBack() {
      location.href = "/";
    }

    document.addEventListener("DOMContentLoaded", loadReferral);
  </script>

</body>
</html>
