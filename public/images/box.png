app.post("/api/open-box", async (req, res) => {
  const { userId } = req.body;

  let user = await User.findOne({ userId });
  if (!user) user = await User.create({ userId });

  // ğŸ”‹ energy regen
  regenEnergy(user);

  if (user.energy < 10) {
    return res.json({ error: "NO_ENERGY" });
  }

  user.energy -= 10;

  const rewards = [
    { type: "coins", value: 100 },
    { type: "coins", value: 300 },
    { type: "token", value: 1 },
    { type: "nothing", value: 0 }
  ];

  const reward = rewards[Math.floor(Math.random() * rewards.length)];

  if (reward.type === "coins") user.balance += reward.value;

  await user.save();

  res.json({
    reward:
      reward.type === "nothing"
        ? "Nothing ğŸ˜¢"
        : `${reward.value} ${reward.type}`,
    energy: user.energy,
    balance: user.balance
  });
});
